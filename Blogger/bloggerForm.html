<!DOCTYPE html>
<html lang="ca">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<head>
    <meta charset="UTF-8">
    <title>Asbaprin Blogger API</title>
    <link rel="stylesheet" href="assets/css/blogger.css">

</head>

<body>
    <header id="capsalera">
        <div class="g_id_signin" data-locale="fr">
        </div>
    </header>
    <main id="cos">
        <div id="formulari">

        </div>
        
    </main>
<script src="https://accounts.google.com/gsi/client?hl=fr" async></script>
<script type="module">
    import {PostService} from './js/service/PostService.js'
    import {idPostService} from './js/service/idPostService.js'
    //const  llistatPosts =  new idPostService();

    function pintarCapsalera(){
        const titol = document.createElement("h1");
        titol.innerHTML="CURS ASBAPRIN API BLOGGER";
        document.querySelector("#capsalera").appendChild(titol);
        
        const subTitol = document.createElement("h2");
        subTitol.innerHTML="FORM BLOGGER";
        document.querySelector("#capsalera").appendChild(subTitol);

        const botoGoogle = document.createElement("button");
        botoGoogle.innerHTML="D=: API GOOGLE";
        botoGoogle.addEventListener('click',initGoogle);
        document.querySelector("#capsalera").appendChild(botoGoogle);

        const botoBlogger = document.createElement("button");
        botoBlogger.innerHTML="D=: API BLOGGER";
        botoBlogger.addEventListener('click',initBlogger);
        document.querySelector("#capsalera").appendChild(botoBlogger);
    

        const botoInsertaPost = document.createElement("button");
        botoInsertaPost.innerHTML="D=: INSPOST";
        botoInsertaPost.addEventListener('click',insertaPost);
        document.querySelector("#capsalera").appendChild(botoInsertaPost);
        

    }
    
        
    async function insertaPost(){
        const nouPost = new PostService();
        let post = await nouPost.insertPost();

        const anterior = document.querySelector("#formulari");
        if(anterior){anterior.remove()}
        
        const formulariPost = document.createElement("div");
        formulariPost.id= "formulari";
        document.querySelector("#cos").appendChild(formulariPost);

        const labelidPost = document.createElement("label");
        labelidPost.innerHTML= "ID:";
        document.querySelector("#formulari").appendChild(labelidPost);
        
        const idPost = document.createElement("h3");
        idPost.innerHTML= post.id;
        document.querySelector("#formulari").appendChild(idPost);

        const labelTitol = document.createElement("label");
        labelTitol.innerHTML= "TITOL:";
        document.querySelector("#formulari").appendChild(labelTitol);
        
        const titolPost = document.createElement("textarea");
        titolPost.value= post.id;
        document.querySelector("#formulari").appendChild(titolPost);

        const labelText = document.createElement("label");
        labelText.innerHTML= "TEXT:";
        document.querySelector("#formulari").appendChild(labelText);
        

        const textPost = document.createElement("textarea");
        textPost.value= post.id;
        document.querySelector("#formulari").appendChild(textPost);

        const botoUpdate = document.createElement("button");
        botoUpdate.value= post.id;
        document.querySelector("#formulari").appendChild(botoUpdate);
    }

    
    function initGoogle(){
        const client = google.accounts.oauth2.initTokenClient({
            client_id: '93131392495-ener171a5pc6c9bhqhn7gck61hiup4bu.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/blogger',//'https://www.googleapis.com/auth/calendar.readonly \ https://www.googleapis.com/auth/blogger'
            callback: (tokenResponse) => {
              if (tokenResponse && tokenResponse.access_token) {
                console.log("tokenResponse: ",tokenResponse,tokenResponse.access_token);
                localStorage.setItem("token",tokenResponse.access_token);
              }
            },
          });
        client.requestAccessToken();
    }

    function initBlogger(){
        /*
        const myHeaders = new Headers();
            myHeaders.append("Authorization",localStorage.getItem('token'));
        console.log("El valor del token és "+ localStorage.getItem('token'));
        const requestOptions = {
            method: "GET",
            headers: myHeaders,
            redirect: "follow"
        };

        fetch("https://www.googleapis.com/blogger/v3/blogs/5061924546610576807", requestOptions)
            .then((response) => response.text())
            .then((result) => console.log(result))
            .catch((error) => console.error(error));
        */
        //const peticioFetch = fetch("https://www.googleapis.com/blogger/v3/blogs/5061924546610576807",{
        console.log("El valor del token és "+ localStorage.getItem('token'));
        const peticioFetch = fetch("https://www.googleapis.com/blogger/v3/blogs/5061924546610576807",{
            method: 'get',
            headers: {
                //'Authorization': localStorage.getItem('token')
                'Authorization': 'Bearer '+localStorage.getItem('token')
            }
        })
        

        
    }

    
    

   
    (()=>{
        const post = new PostService();
        
        pintarCapsalera();
        
    })()
</script>
</body>

</html>